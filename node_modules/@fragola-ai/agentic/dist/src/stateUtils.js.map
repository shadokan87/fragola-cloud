{
  "version": 3,
  "sources": ["../../src/stateUtils.ts"],
  "sourcesContent": ["import OpenAI from \"openai\";\nimport type { AgentState } from \"./agent\";\n\nconst getToolCallOrigin = (\n    conversation: OpenAI.ChatCompletionMessageParam[],\n    message: OpenAI.ChatCompletionToolMessageParam\n): OpenAI.ChatCompletionMessageToolCall | undefined => {\n    let found: OpenAI.ChatCompletionMessageToolCall | undefined = undefined;\n    conversation.find(msg => {\n        if (\n            msg.role === \"assistant\" &&\n            msg.tool_calls &&\n            msg.tool_calls.some(toolCall => {\n                if (toolCall.id === message.tool_call_id) {\n                    found = toolCall;\n                    return true;\n                }\n                return false;\n            })\n        ) {\n            return true;\n        }\n        return false;\n    });\n    return found;\n};\n\nexport function createStateUtils(state: AgentState) {\n    return {\n        /**\n         * From a role 'tool' message, return its origin where requested by the model in the conversation\n         * \n         * @param message - The tool message parameter containing the tool call ID to search for.\n         * @returns The matching tool call object if found, otherwise `undefined`.\n         *\n         * @example\n         * const utils = createStateUtils(state);\n         * // Assuming the message is the following\n         * // { role: \"tool\", tool_call_id: \"tool_123\", content: \"Result\" };\n         * const toolCall = utils.toolCallOrigin(state.conversation.at(-1).tool_calls[0]);\n         * // toolCall will be { id: \"tool_123\", function: { name: \"getWeather\", arguments: \"{}\" } }\n         */\n        toolCallOrigin: (message: OpenAI.ChatCompletionToolMessageParam) => {\n            return getToolCallOrigin(state.conversation, message);\n        },\n\n        /**\n         * Returns the final assistant output message from the conversation.\n         *\n         * This returns the last message in the conversation if it is an assistant message\n         * and does not contain any tool calls (i.e., it is a final response, not a tool request).\n         *\n         * @returns The final assistant message if present, otherwise `undefined`.\n         *\n         * @example\n         * const utils = createStateUtils(state);\n         * const finalOutput = utils.finalOutput();\n         * if (finalOutput) {\n         *   console.log(finalOutput.content);\n         * }\n         */\n        finalOutput: () => {\n            const lastMessage = state.conversation.at(-1);\n            if (!lastMessage || !(lastMessage.role == \"assistant\" && !lastMessage.tool_calls && state.status == \"idle\"))\n                return undefined;\n            return lastMessage;\n        }\n    };\n}"],
  "mappings": "AAAA,MAAmB,SAGnB,MAAMA,EAAoB,CACtBC,EACAC,IACmD,CACnD,IAAIC,EACJ,OAAAF,EAAa,KAAKG,GAEV,GAAAA,EAAI,OAAS,aACbA,EAAI,YACJA,EAAI,WAAW,KAAKC,GACZA,EAAS,KAAOH,EAAQ,cACxBC,EAAQE,EACD,IAEJ,EACV,EAKR,EACMF,CACX,EAEO,SAASG,EAAiBC,EAAmB,CAChD,MAAO,CAcH,eAAiBL,GACNF,EAAkBO,EAAM,aAAcL,CAAO,EAkBxD,YAAa,IAAM,CACf,MAAMM,EAAcD,EAAM,aAAa,GAAG,EAAE,EAC5C,GAAI,GAACC,GAAe,EAAEA,EAAY,MAAQ,aAAe,CAACA,EAAY,YAAcD,EAAM,QAAU,SAEpG,OAAOC,CACX,CACJ,CACJ",
  "names": ["getToolCallOrigin", "conversation", "message", "found", "msg", "toolCall", "createStateUtils", "state", "lastMessage"]
}
